const cloud=require("wx-server-sdk"),TcbRouter=require("tcb-router"),resConfig=require("./config"),createHandler=require("./_create_handler"),getHandler=require("./_get_handler"),CODE=resConfig.CODE;cloud.init({env:cloud.DYNAMIC_CURRENT_ENV,throwOnNotFound:!1});const db=cloud.database();exports.main=async(e,r)=>{const a=new TcbRouter({event:e}),{queryParams:t}=e,n=function(e,r){a.router(e,(async(e,a)=>{await r(e,db,t,CODE),await a()}),(async e=>{e.body={code:e.code||CODE.SUCCESS,message:e.message,data:e.data}}))};return a.use((async(e,r)=>{e.data={},await r()})),n("createTransferProgress",createHandler),n("getTransferProgress",getHandler),a.serve()};