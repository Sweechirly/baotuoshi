module.exports=async function(e,t,a,o){try{const{workContent:d}=a,n=t.command,i=new Date,c=Object.assign({_openid:e.data._openid,content:{url:""},createTime:i,deleted:!1,recipientId:""},d),s=await t.runTransaction((async t=>{const a=await t.collection("work_list").add({data:c}),o=a._id&&await t.collection("user_list").where({_openid:e.data._openid}).update({data:{myWorks:n.push(a._id)}});if(o?.stats?.updated)return c._id=a._id,c.createTime=i.toString(),console.log("addWorkRes",c),c;await t.rollback(-100)}));console.log("事务处理结果:",s),e.code=o.SUCCESS,e.data=s,e.message="作品创作成功"}catch(t){e.code=o.SERVER_ERROR,e.message="服务器出错"}};