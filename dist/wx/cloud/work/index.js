const cloud=require("wx-server-sdk"),TcbRouter=require("tcb-router"),resConfig=require("./config"),createHandler=require("./_create_handler"),deleteHandler=require("./_delete_handler"),receiveHandler=require("./_receive_handler"),CODE=resConfig.CODE;cloud.init({env:cloud.DYNAMIC_CURRENT_ENV,throwOnNotFound:!1});const db=cloud.database();exports.main=async(e,r)=>{const a=cloud.getWXContext(),n=new TcbRouter({event:e}),{queryParams:t}=e,d=a.OPENID,o=function(e,r){n.router(e,(async(e,n)=>{console.log("user openId: ",d,JSON.stringify(a)),await r(e,db,t,CODE),await n()}),(async e=>{e.body={code:e.code||CODE.SUCCESS,message:e.message,data:e.data}}))};return n.use((async(e,r)=>{e.data={_openid:d},await r()})),o("create",createHandler),o("delete",deleteHandler),o("receive",receiveHandler),n.serve()};